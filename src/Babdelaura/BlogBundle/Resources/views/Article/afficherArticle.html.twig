{% extends "BabdelauraBlogBundle::layout.html.twig" %}

{% set metaDescription = article.contenu | truncate(500,true) | striptags %}

{% block facebookMetas %}
    {% set ogImage = asset(article.image.webPath) %}
    {% set ogTitle = article.titre %}

    {{ parent() }}
    <meta property="article:author" content="https://www.facebook.com/BabDeLaura" />
    <meta property="article:publisher" content="https://www.facebook.com/BabDeLaura" />
{% endblock %}

{% block pageTitle %}{{article.titre}} | {% endblock %}


{% block mainContent %}

    {% for flashMessage in app.session.flashbag.get('notice') %}
        <div class="bab-Notification bab-Notification--success">
            <div class="bab-Notification-content">{{ flashMessage }}</div>
        </div>
    {% endfor %}

    <section itemscope itemtype="http://schema.org/BlogPosting">
        {% set nbCommentaires = article.getNbCommentaires(true) %}
        <header>
            <h1 class="bab-Article-title" itemprop="name">{{ article.titre }}</h1>
            <aside class="bab-Article-infos">
                <time pubdate itemprop="datePublished">
                    Le {{ article.datePublication|date("d/m/Y à H:i") }}
                </time>
                -
                <a href="#commentaires" title="Accéder aux commentaires">
                    {{ nbCommentaires }}
                    {% if nbCommentaires <= 1 %}commentaire{% else %}commentaires{% endif %}
                </a>
                <ul class="bab-Article-categories" itemprop="keywords">
                    {% for categorie in article.categories %}
                        <li class="bab-Article-category">
                            <a href="{{ path('babdelaurablog_categorie', {'slug' : categorie.slug}) }}">
                                {{categorie.nom}}{% if not loop.last %},{% endif %}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </aside>
        </header>
        <div class="bab-Article-content gallery" itemprop="articleBody">
            <p>{{article.contenu | raw}}</p>
        </div>
        {% include 'BabdelauraBlogBundle::Article/social-share.html.twig' %}
    </section>

    <nav class="bab-Article-navigation">
        {% if articlePrecedent is not null %}
            <a class="bab-Button" href="{{ path('babdelaurablog_article', {'slug': articlePrecedent.slug, 'annee': articlePrecedent.datePublication|date("Y"), 'mois': articlePrecedent.datePublication|date("m"), 'jour': articlePrecedent.datePublication|date("d")}) }}">
                <i class="fa fa-chevron-circle-left"></i> Article précédent
            </a>
        {% endif %}

        {% if articleSuivant is not null %}
            <a class="bab-Button pull-right" href="{{ path('babdelaurablog_article', {'slug': articleSuivant.slug, 'annee': articleSuivant.datePublication|date("Y"), 'mois': articleSuivant.datePublication|date("m"), 'jour': articleSuivant.datePublication|date("d")}) }}">
                Article suivant <i class="fa fa-chevron-circle-right"></i>
            </a>
        {% endif %}
    </nav>

    <h1 id="commentaires">Commentaires</h1>
    {% if nbCommentaires > 0 %}
    <ul class="list-unstyled">
        {% for commentaire in article.commentaires %}
            {% if commentaire.valide %}
            <li class="bab-Comment">
                <header class="bab-Comment-header">
                    <i class="fa fa-user"></i>
                    {% if commentaire.site %}
                        <a href="{{ asset(commentaire.site) }}" target="_blank">{{ commentaire.auteur }}</a>
                    {% else %}
                        {{ commentaire.auteur }}
                    {% endif %}
                    <span class="bab-Comment-date">le {{ commentaire.datePublication|date("d/m/Y à H:i") }}</span>
                </header>
                <div class="bab-Comment-content">
                    {{ commentaire.contenu }}
                </div>
            </li>
            {% endif %}
        {% endfor %}

    </ul>

    {% else %}
        <p>
            Aucun commentaire. Soyez le premier à commenter.
        </p>
    {% endif %}
    <form class="comment-form" action="#commentaires" method="post" class="comment-form" id="new-comment">
        <h1>Poster un commentaire</h1>
        <div class="form-group">
            {{ form_label(form.auteur, "Votre nom") }}
            {{ form_widget(form.auteur) }}
        </div>
        <div class="form-group">
            {{ form_label(form.email, "Votre adresse mail") }}
            {{ form_widget(form.email) }}
        </div>
        <div class="form-group">
            {{ form_label(form.site, "Votre site") }}
            {{ form_widget(form.site) }}
        </div>
        <div class="form-group">
            {{ form_label(form.contenu, "Votre commentaire") }}
            {{ form_widget(form.contenu) }}
        </div>
        <div class="form-group">
            {{ form_label(form.recaptcha, "Veuillez recopier le texte qui se trouve dans l'image ci-dessous") }}
            {{ form_widget(form.recaptcha) }}
        </div>
        {{ form_widget(form._token) }}

        <button class="bab-Button" type="submit">Envoyer mon commentaire</button>
    </form>

    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--share" title="Share"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>

                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div>
                </div>

                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>

                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>

                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{parent()}}
    <script>
        (function($) {
            var $notification = $('.bab-Notification');

            function closeNotification() {
                $notification.remove();
            }

            setTimeout(closeNotification, 10000);
        })(jQuery);
    </script>
{% endblock %}
